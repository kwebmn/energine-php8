# Energine PHP 8 Edition

Модернизированная версия CMS Energine, основанная на форке проекта [energine-cmf](https://github.com/energine-cmf) и адаптированная к современным стандартам PHP и фронтенда. Цель репозитория — сохранить совместимость с исходным ядром и при этом предложить обновлённую инфраструктуру разработки, готовую для продакшена.

## Исходная база форка
- Проект импортирован с релиза Energine **2.11.4** (ветка `2.11.x`), что видно из конфигурации `system.config.php`. Это не самый свежий master репозитория energine-cmf, поэтому стандартные модули и XSLT-шаблоны соответствуют именно этой линии разработки.
- Поверх ядра 2.11.4 добавлены composer-ориентированная загрузка, PHP 8.4-совместимые правки и отдельный namespace `App\` с сервисами/утилитами, чтобы упрощать перенос существующих проектов на новый стек без миграции на более поздние ветки оригинала.

## Ключевые отличия от оригинального Energine
- **Минимальные требования PHP 8.4+ и Composer-first подход.** Проект требует актуальный рантайм PHP 8.4 с включённым OPCache и использует Composer для управления зависимостями и автозагрузкой PSR-4/классов наследия.
- **Современные точки входа и сигнатуры.** Класс `App\\Bootstrap\\EnergineBootstrapper` и фронт-контроллер `index.php` переписаны под строгие типы, обёрнуты в исключения и интегрируют Composer autoload/Whoops, чего не было в релизе 2.11.4.
- **Интеграция с современными PHP-библиотеками.** Bootstrap подключает и настраивает опциональные компоненты: контейнер зависимостей PHP-DI, логгер Monolog, кэш Symfony Cache (включая Redis/APCu/файловый адаптер), Doctrine DBAL, а также пакеты Symfony для Translation, Validator и HttpFoundation. Это облегчает внедрение типовых инфраструктурных сервисов по сравнению с «монолитным» стеком оригинала.
- **ES6 вместо Mootools.** Клиентские модули панели управления переписаны на нативные ES6-классы (пример — `UserManager`), что снимает зависимость от устаревшей библиотеки Mootools и упрощает поддержку/расширение фронтенда.
- **Автоочистка кеша изображений из коробки.** Сервис `ImageService` при каждом обращении удаляет устаревшие файлы в кеше, используя настраиваемые интервалы и сроки жизни, поэтому не требуется отдельный cron-джоб.
- **Служебные маршруты на Symfony HttpFoundation.** Примерный `Router` демонстрирует, как реализовать health-check и другие вспомогательные маршруты на базе Request/Response из Symfony, что облегчает интеграцию с внешними сервисами и оркестраторами.

## Преимущества
- **Будущее-доказанный стек.** Поддержка PHP 8.4 и актуальных PSR-интерфейсов упрощает подключение новых библиотек и анализ статическими инструментами.
- **Наблюдаемость и отказоустойчивость.** Whoops обеспечивает подробные страницы ошибок в dev-режиме, Monolog даёт единый канал логирования, а кэш/DI настраиваются централизованно через конфиг.
- **Снижение технического долга фронтенда.** ES6-классы проще тестировать и расширять, чем наследие на Mootools, при этом сохраняется совместимость со ScriptLoader и API ядра.
- **Более простое обслуживание медиа.** Встроенный сборщик мусора кеша изображений минимизирует необходимость ручной очистки и снижает нагрузку на файловую систему.
- **Приведение точек входа к современному PHP-коду.** Front controller использует строгие типы, Composer autoload и вшитую интеграцию Whoops/health-check, что упрощает деплой и диагностику по сравнению с оригинальными `index.php` и процедурным `bootstrap.php` ветки 2.11.x.

## Структура проекта
- `engine/` — ядро Energine (форк оригинального репозитория).
- `app/` — расширения приложения: PHP-код, вспомогательные классы, маршрутизаторы и хелперы.
- `site/` — пользовательские модули и шаблоны.
- `App\\Bootstrap\\EnergineBootstrapper` — точка инициализации, отвечающая за загрузку конфигурации, автозагрузку и подключение опциональных сервисов.


## Требования
- PHP 8.4+ с расширением `ext-opcache`.
- Composer для установки зависимостей.

- Доступ к Redis/APCu (опционально) при использовании соответствующих адаптеров кэша.

## Быстрый старт
1. Установите зависимости: `composer install`.
2. Скопируйте и настройте `system.config.php`, указав пути к ядру, сайту, базе данных и включаемым фичам.
3. Запустите установщик через веб-интерфейс `/setup` или CLI `php index.php setup`, чтобы подготовить базу данных и артефакты ядра.
4. Настройте фичи (DI, кэш, логирование, переводчики) в конфигурации при необходимости.
5. Разверните приложение — health-check доступен по маршруту, подключенному через `App\Routing\Router::health`.

## Статический анализ
- `composer phpstan` — базовая проверка проекта согласно `phpstan.neon.dist`.
- `composer phpstan:dead-code` — максимальный уровень анализа с правилами поиска мёртвого кода.

Подробнее о настройке и интеграции анализатора см. в [docs/static-analysis.md](docs/static-analysis.md).


---

Проект остаётся совместимым с оригинальным API Energine, но благодаря обновлённой серверной и клиентской инфраструктуре позволяет безопасно мигрировать существующие решения на современный стек PHP/JS.
