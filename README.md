# Energine PHP 8 Edition

Модернизированная версия CMS Energine, основанная на форке проекта [energine-cmf](https://github.com/energine-cmf) и адаптированная к современным стандартам PHP и фронтенда. Цель репозитория — сохранить совместимость с исходным ядром и при этом предложить обновлённую инфраструктуру разработки, готовую для продакшена.

## Исходная база форка
- Проект импортирован с релиза Energine **2.11.4** (ветка `2.11.x`), что видно из конфигурации `system.config.php`. Это не самый свежий master репозитория energine-cmf, поэтому стандартные модули и XSLT-шаблоны соответствуют именно этой линии разработки.【F:system.config.php†L12-L47】
- Поверх ядра 2.11.4 добавлены composer-ориентированная загрузка, PHP 8.3-совместимые правки и отдельный namespace `App\` с сервисами/утилитами, чтобы упрощать перенос существующих проектов на новый стек без миграции на более поздние ветки оригинала.【F:bootstrap.php†L9-L321】【F:app/src/Image/ImageService.php†L5-L106】

## Ключевые отличия от оригинального Energine
- **Минимальные требования PHP 8.3+ и Composer-first подход.** Проект требует актуальный рантайм PHP 8.3 с включённым OPCache и использует Composer для управления зависимостями и автозагрузкой PSR-4/классов наследия.【F:composer.json†L1-L37】
- **Современные точки входа и сигнатуры.** `bootstrap.php` и `index.php` переписаны под строгие типы, обёрнуты в исключения и интегрируют Composer autoload/Whoops, чего не было в релизе 2.11.4.【F:bootstrap.php†L9-L321】【F:index.php†L1-L74】
- **Интеграция с современными PHP-библиотеками.** Bootstrap подключает и настраивает опциональные компоненты: контейнер зависимостей PHP-DI, логгер Monolog, кэш Symfony Cache (включая Redis/APCu/файловый адаптер), Doctrine DBAL, а также пакеты Symfony для Translation, Validator и HttpFoundation.【F:bootstrap.php†L100-L321】 Это облегчает внедрение типовых инфраструктурных сервисов по сравнению с «монолитным» стеком оригинала.
- **ES6 вместо Mootools.** Клиентские модули панели управления переписаны на нативные ES6-классы (пример — `UserManager`), что снимает зависимость от устаревшей библиотеки Mootools и упрощает поддержку/расширение фронтенда.【F:engine/core/modules/user/scripts/UserManager.js†L1-L35】
- **Автоочистка кеша изображений из коробки.** Сервис `ImageService` при каждом обращении удаляет устаревшие файлы в кеше, используя настраиваемые интервалы и сроки жизни, поэтому не требуется отдельный cron-джоб.【F:app/src/Image/ImageService.php†L5-L106】
- **Служебные маршруты на Symfony HttpFoundation.** Примерный `Router` демонстрирует, как реализовать health-check и другие вспомогательные маршруты на базе Request/Response из Symfony, что облегчает интеграцию с внешними сервисами и оркестраторами.【F:app/src/Routing/Router.php†L1-L24】

## Преимущества
- **Будущее-доказанный стек.** Поддержка PHP 8.3 и актуальных PSR-интерфейсов упрощает подключение новых библиотек и анализ статическими инструментами.【F:composer.json†L1-L48】
- **Наблюдаемость и отказоустойчивость.** Whoops обеспечивает подробные страницы ошибок в dev-режиме, Monolog даёт единый канал логирования, а кэш/DI настраиваются централизованно через конфиг.【F:bootstrap.php†L100-L276】
- **Снижение технического долга фронтенда.** ES6-классы проще тестировать и расширять, чем наследие на Mootools, при этом сохраняется совместимость со ScriptLoader и API ядра.【F:engine/core/modules/user/scripts/UserManager.js†L1-L35】
- **Более простое обслуживание медиа.** Встроенный сборщик мусора кеша изображений минимизирует необходимость ручной очистки и снижает нагрузку на файловую систему.【F:app/src/Image/ImageService.php†L17-L88】
- **Приведение точек входа к современному PHP-коду.** Front controller использует строгие типы, Composer autoload и вшитую интеграцию Whoops/health-check, что упрощает деплой и диагностику по сравнению с оригинальными `index.php` и `bootstrap.php` ветки 2.11.x.【F:index.php†L1-L74】【F:bootstrap.php†L9-L321】

## Структура проекта
- `engine/` — ядро Energine (форк оригинального репозитория).
- `app/` — расширения приложения: PHP-код, вспомогательные классы, маршрутизаторы и хелперы.【F:composer.json†L27-L37】【F:app/src/Routing/Router.php†L1-L24】
- `site/` — пользовательские модули и шаблоны.
- `bootstrap.php` — точка инициализации, отвечающая за загрузку конфигурации, автозагрузку и подключение опциональных сервисов.【F:bootstrap.php†L9-L321】

## Требования
- PHP 8.3+ с расширением `ext-opcache`.
- Composer для установки зависимостей.
- Доступ к Redis/APCu (опционально) при использовании соответствующих адаптеров кэша.【F:composer.json†L4-L24】【F:bootstrap.php†L181-L205】

## Быстрый старт
1. Установите зависимости: `composer install`.
2. Скопируйте и настройте `system.config.php`, указав пути к ядру, сайту, базе данных и включаемым фичам.【F:bootstrap.php†L15-L178】
3. Запустите установщик через веб-интерфейс `/setup` или CLI `php index.php setup`, чтобы подготовить базу данных и артефакты ядра.【F:bootstrap.php†L76-L88】
4. Настройте фичи (DI, кэш, логирование, переводчики) в конфигурации при необходимости.【F:bootstrap.php†L150-L321】
5. Разверните приложение — health-check доступен по маршруту, подключенному через `App\Routing\Router::health`.【F:app/src/Routing/Router.php†L14-L23】

---

Проект остаётся совместимым с оригинальным API Energine, но благодаря обновлённой серверной и клиентской инфраструктуре позволяет безопасно мигрировать существующие решения на современный стек PHP/JS.
